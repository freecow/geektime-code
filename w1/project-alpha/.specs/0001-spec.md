# Project Alpha - 票务标签管理系统

## 文档信息
- **项目名称**: Project Alpha
- **文档版本**: v1.0
- **创建日期**: 2025-12-11
- **文档类型**: 需求与设计规格说明

---

## 1. 项目概述

### 1.1 项目简介
Project Alpha 是一个轻量级的票务管理工具，通过标签系统来组织和分类任务票据（Tickets）。该系统无需用户认证，专注于提供简洁高效的票务管理体验。

### 1.2 技术栈
- **后端**: FastAPI (Python，使用uv)
- **数据库**: PostgreSQL
- **前端**: TypeScript + Vite + Tailwind CSS + Shadcn UI
- **API通信**: RESTful API

### 1.3 核心特性
- 票务的全生命周期管理（创建、编辑、删除、完成状态切换）
- 灵活的标签系统
- 基于标签的过滤查看
- 标题搜索功能
- 无需用户认证系统

---

## 2. 功能需求

### 2.1 票务管理

#### 2.1.1 创建票务
- **功能描述**: 用户可以创建新的票务
- **必填字段**:
  - 标题（Title）: 字符串，最大长度200字符
- **可选字段**:
  - 描述（Description）: 文本，支持长文本
  - 标签（Tags）: 多个标签的集合
- **系统自动生成**:
  - ID: 唯一标识符
  - 创建时间（Created At）
  - 更新时间（Updated At）
  - 状态（Status）: 默认为"未完成"

#### 2.1.2 编辑票务
- **功能描述**: 用户可以修改现有票务的信息
- **可编辑字段**:
  - 标题
  - 描述
- **系统自动更新**:
  - 更新时间

#### 2.1.3 删除票务
- **功能描述**: 永久删除票务及其关联的标签关系
- **操作方式**: 物理删除（真实删除数据库记录）
- **确认机制**: 前端提供二次确认提示

#### 2.1.4 完成/取消完成票务
- **功能描述**: 切换票务的完成状态
- **状态类型**:
  - 未完成（pending）
  - 已完成（completed）
- **操作方式**: 状态切换toggle
- **系统自动更新**: 更新时间

### 2.2 标签管理

#### 2.2.1 添加标签到票务
- **功能描述**: 为票务添加一个或多个标签
- **标签特性**:
  - 标签名称唯一
  - 自动创建：如果标签不存在，系统自动创建
  - 多标签支持：一个票务可以有多个标签
  - 防重复：同一标签不能重复添加到同一票务

#### 2.2.2 从票务移除标签
- **功能描述**: 从票务中移除指定标签
- **系统行为**:
  - 仅删除关联关系，不删除标签本身
  - 如果标签不再被任何票务使用，可选择性保留或清理

#### 2.2.3 标签颜色
- **功能描述**: 每个标签可以有自定义颜色用于视觉区分
- **颜色方案**: 预设8-10种颜色，创建标签时随机分配或手动选择

### 2.3 查询与过滤

#### 2.3.1 按标签过滤票务
- **功能描述**: 用户可以选择一个或多个标签来过滤票务列表
- **过滤逻辑**:
  - 单标签：显示包含该标签的所有票务
  - 多标签：显示同时包含所有选中标签的票务（AND逻辑）
- **特殊视图**:
  - "全部票务"：显示所有票务
  - "无标签"：显示没有任何标签的票务

#### 2.3.2 按标题搜索
- **功能描述**: 根据标题关键词搜索票务
- **搜索特性**:
  - 模糊匹配
  - 大小写不敏感
  - 实时搜索（输入延迟500ms后触发）
- **搜索范围**: 仅搜索票务标题字段

#### 2.3.3 状态过滤
- **功能描述**: 按完成状态过滤票务
- **过滤选项**:
  - 全部
  - 仅未完成
  - 仅已完成

---

## 3. 数据模型设计

### 3.1 数据表结构

#### 3.1.1 Tickets 表
```sql
CREATE TABLE tickets (
    id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT check_status CHECK (status IN ('pending', 'completed'))
);

CREATE INDEX idx_tickets_status ON tickets(status);
CREATE INDEX idx_tickets_title ON tickets(title);
CREATE INDEX idx_tickets_created_at ON tickets(created_at DESC);
```

**字段说明**:
- `id`: 主键，自增整数
- `title`: 票务标题，非空，最大200字符
- `description`: 票务描述，可选，长文本
- `status`: 状态，枚举值（pending/completed），默认pending
- `created_at`: 创建时间，带时区的时间戳
- `updated_at`: 更新时间，带时区的时间戳

#### 3.1.2 Tags 表
```sql
CREATE TABLE tags (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE,
    color VARCHAR(7) NOT NULL DEFAULT '#3B82F6',
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

CREATE UNIQUE INDEX idx_tags_name ON tags(name);
```

**字段说明**:
- `id`: 主键，自增整数
- `name`: 标签名称，非空，唯一
- `color`: 标签颜色，十六进制颜色代码（如 #3B82F6）
- `created_at`: 创建时间

#### 3.1.3 Ticket_Tags 关联表
```sql
CREATE TABLE ticket_tags (
    ticket_id INTEGER NOT NULL,
    tag_id INTEGER NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    PRIMARY KEY (ticket_id, tag_id),
    FOREIGN KEY (ticket_id) REFERENCES tickets(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE
);

CREATE INDEX idx_ticket_tags_tag_id ON ticket_tags(tag_id);
CREATE INDEX idx_ticket_tags_ticket_id ON ticket_tags(ticket_id);
```

**字段说明**:
- `ticket_id`: 票务ID，外键
- `tag_id`: 标签ID，外键
- `created_at`: 关联创建时间
- 复合主键：(ticket_id, tag_id) 确保唯一性
- 级联删除：删除票务或标签时自动删除关联关系

### 3.2 数据模型ER图

```
┌─────────────────┐         ┌──────────────────┐         ┌─────────────────┐
│     Tickets     │         │   Ticket_Tags    │         │      Tags       │
├─────────────────┤         ├──────────────────┤         ├─────────────────┤
│ id (PK)         │◄───────┤ ticket_id (FK)   │         │ id (PK)         │
│ title           │         │ tag_id (FK)      ├────────►│ name (UNIQUE)   │
│ description     │         │ created_at       │         │ color           │
│ status          │         └──────────────────┘         │ created_at      │
│ created_at      │                                       └─────────────────┘
│ updated_at      │
└─────────────────┘

关系: Tickets *──────* Tags (多对多)
```

---

## 4. API 接口设计

### 4.1 基础配置
- **Base URL**: `/api/v1`
- **Content-Type**: `application/json`
- **日期格式**: ISO 8601 (例: `2025-12-11T10:30:00Z`)

### 4.2 票务接口

#### 4.2.1 获取票务列表
```
GET /api/v1/tickets
```

**查询参数**:
- `status`: (可选) `pending` | `completed` | `all` - 默认 `all`
- `tag_ids`: (可选) 逗号分隔的标签ID列表，例: `1,2,3`
- `search`: (可选) 搜索关键词
- `page`: (可选) 页码，默认 1
- `page_size`: (可选) 每页数量，默认 50，最大 100

**响应示例**:
```json
{
  "data": [
    {
      "id": 1,
      "title": "修复登录页面样式问题",
      "description": "登录按钮在移动端显示不正常",
      "status": "pending",
      "tags": [
        {
          "id": 1,
          "name": "bug",
          "color": "#EF4444"
        },
        {
          "id": 2,
          "name": "frontend",
          "color": "#3B82F6"
        }
      ],
      "created_at": "2025-12-10T10:00:00Z",
      "updated_at": "2025-12-11T08:30:00Z"
    }
  ],
  "total": 45,
  "page": 1,
  "page_size": 50,
  "total_pages": 1
}
```

#### 4.2.2 获取单个票务详情
```
GET /api/v1/tickets/{ticket_id}
```

**响应示例**:
```json
{
  "id": 1,
  "title": "修复登录页面样式问题",
  "description": "登录按钮在移动端显示不正常",
  "status": "pending",
  "tags": [
    {
      "id": 1,
      "name": "bug",
      "color": "#EF4444"
    }
  ],
  "created_at": "2025-12-10T10:00:00Z",
  "updated_at": "2025-12-11T08:30:00Z"
}
```

#### 4.2.3 创建票务
```
POST /api/v1/tickets
```

**请求体**:
```json
{
  "title": "实现用户导出功能",
  "description": "允许用户导出数据为CSV格式",
  "tag_ids": [3, 5]
}
```

**响应示例** (201 Created):
```json
{
  "id": 2,
  "title": "实现用户导出功能",
  "description": "允许用户导出数据为CSV格式",
  "status": "pending",
  "tags": [
    {
      "id": 3,
      "name": "feature",
      "color": "#10B981"
    },
    {
      "id": 5,
      "name": "backend",
      "color": "#8B5CF6"
    }
  ],
  "created_at": "2025-12-11T10:30:00Z",
  "updated_at": "2025-12-11T10:30:00Z"
}
```

#### 4.2.4 更新票务
```
PUT /api/v1/tickets/{ticket_id}
```

**请求体**:
```json
{
  "title": "实现用户导出功能（更新）",
  "description": "允许用户导出数据为CSV和Excel格式"
}
```

**响应示例** (200 OK): 返回更新后的完整票务对象

#### 4.2.5 删除票务
```
DELETE /api/v1/tickets/{ticket_id}
```

**响应**: 204 No Content

#### 4.2.6 切换票务完成状态
```
PATCH /api/v1/tickets/{ticket_id}/toggle-status
```

**响应示例** (200 OK):
```json
{
  "id": 1,
  "status": "completed",
  "updated_at": "2025-12-11T10:35:00Z"
}
```

### 4.3 标签接口

#### 4.3.1 获取所有标签
```
GET /api/v1/tags
```

**查询参数**:
- `with_count`: (可选) boolean - 是否包含每个标签关联的票务数量，默认 false

**响应示例**:
```json
{
  "data": [
    {
      "id": 1,
      "name": "bug",
      "color": "#EF4444",
      "ticket_count": 12,
      "created_at": "2025-12-01T10:00:00Z"
    },
    {
      "id": 2,
      "name": "feature",
      "color": "#10B981",
      "ticket_count": 8,
      "created_at": "2025-12-01T10:05:00Z"
    }
  ],
  "total": 2
}
```

#### 4.3.2 创建标签
```
POST /api/v1/tags
```

**请求体**:
```json
{
  "name": "urgent",
  "color": "#F59E0B"
}
```

**响应示例** (201 Created):
```json
{
  "id": 6,
  "name": "urgent",
  "color": "#F59E0B",
  "created_at": "2025-12-11T10:40:00Z"
}
```

#### 4.3.3 更新标签
```
PUT /api/v1/tags/{tag_id}
```

**请求体**:
```json
{
  "name": "critical",
  "color": "#DC2626"
}
```

#### 4.3.4 删除标签
```
DELETE /api/v1/tags/{tag_id}
```

**响应**: 204 No Content
**说明**: 删除标签会同时删除所有相关的票务-标签关联

### 4.4 票务-标签关联接口

#### 4.4.1 为票务添加标签
```
POST /api/v1/tickets/{ticket_id}/tags
```

**请求体**:
```json
{
  "tag_ids": [1, 2, 3]
}
```

或创建新标签并关联:
```json
{
  "tag_names": [
    {
      "name": "new-tag",
      "color": "#6366F1"
    }
  ]
}
```

**响应示例** (200 OK): 返回更新后的完整票务对象

#### 4.4.2 从票务移除标签
```
DELETE /api/v1/tickets/{ticket_id}/tags/{tag_id}
```

**响应**: 204 No Content

### 4.5 错误响应格式

所有错误响应遵循统一格式:

```json
{
  "error": {
    "code": "RESOURCE_NOT_FOUND",
    "message": "票务不存在",
    "details": {
      "ticket_id": 999
    }
  }
}
```

**常见错误码**:
- `400` - 请求参数错误
- `404` - 资源不存在
- `409` - 资源冲突（如标签名称重复）
- `422` - 验证失败
- `500` - 服务器内部错误

---

## 5. 前端设计

### 5.1 技术架构

#### 5.1.1 技术选型
- **框架**: React 18+ with TypeScript
- **构建工具**: Vite 5+
- **样式**: Tailwind CSS 3+
- **组件库**: Shadcn UI
- **状态管理**: React Context + Hooks / Zustand（可选）
- **HTTP客户端**: Axios 或 Fetch API
- **路由**: React Router 6+ (可选，视单页需求而定)
- **表单处理**: React Hook Form
- **日期处理**: date-fns

#### 5.1.2 目录结构
```
frontend/
├── src/
│   ├── components/           # 可复用组件
│   │   ├── ui/              # Shadcn UI 组件
│   │   ├── tickets/         # 票务相关组件
│   │   ├── tags/            # 标签相关组件
│   │   └── common/          # 通用组件
│   ├── api/                 # API 调用封装
│   ├── hooks/               # 自定义 Hooks
│   ├── types/               # TypeScript 类型定义
│   ├── utils/               # 工具函数
│   ├── App.tsx              # 主应用组件
│   └── main.tsx             # 入口文件
├── public/
├── index.html
├── package.json
├── tsconfig.json
├── vite.config.ts
└── tailwind.config.js
```

### 5.2 页面布局

#### 5.2.1 主界面布局

```
┌────────────────────────────────────────────────────────────┐
│  Project Alpha - 票务管理                      [+ 新建票务]  │
├────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────────────┐  ┌──────────────────────────┐│
│  │  侧边栏 - 标签筛选       │  │   主内容区 - 票务列表      ││
│  │                          │  │                            ││
│  │  🔍 搜索标签...          │  │  🔍 搜索票务标题...        ││
│  │                          │  │                            ││
│  │  ☑ 全部票务 (45)        │  │  ┌──────────────────────┐ ││
│  │  ☐ 无标签 (3)           │  │  │ ☐ 修复登录页面样式问题│ ││
│  │                          │  │  │   🏷 bug  🏷 frontend │ ││
│  │  标签列表：              │  │  │   2025-12-11         │ ││
│  │  ☐ 🏷 bug (12)          │  │  └──────────────────────┘ ││
│  │  ☐ 🏷 feature (8)       │  │                            ││
│  │  ☐ 🏷 frontend (15)     │  │  ┌──────────────────────┐ ││
│  │  ☐ 🏷 backend (10)      │  │  │ ☑ 实现用户导出功能    │ ││
│  │  ☐ 🏷 urgent (5)        │  │  │   🏷 feature          │ ││
│  │                          │  │  │   2025-12-10         │ ││
│  │  [+ 新建标签]           │  │  └──────────────────────┘ ││
│  │                          │  │                            ││
│  │  状态筛选：              │  │  分页: ← 1 2 3 →          ││
│  │  ○ 全部                 │  │                            ││
│  │  ● 未完成               │  │                            ││
│  │  ○ 已完成               │  │                            ││
│  └──────────────────────────┘  └──────────────────────────┘│
│                                                              │
└────────────────────────────────────────────────────────────┘
```

### 5.3 核心组件设计

#### 5.3.1 TicketCard 组件
**功能**: 显示单个票务卡片
**Props**:
```typescript
interface TicketCardProps {
  ticket: Ticket;
  onToggleStatus: (ticketId: number) => void;
  onEdit: (ticket: Ticket) => void;
  onDelete: (ticketId: number) => void;
  onRemoveTag: (ticketId: number, tagId: number) => void;
}
```

**状态显示**:
- 未完成：空心复选框
- 已完成：实心复选框，标题带删除线，灰色背景

#### 5.3.2 TicketList 组件
**功能**: 显示票务列表并处理分页
**Props**:
```typescript
interface TicketListProps {
  filters: TicketFilters;
  onTicketUpdate: () => void;
}
```

#### 5.3.3 TagFilter 组件
**功能**: 侧边栏标签筛选
**Props**:
```typescript
interface TagFilterProps {
  tags: Tag[];
  selectedTagIds: number[];
  onTagSelect: (tagIds: number[]) => void;
}
```

#### 5.3.4 TicketDialog 组件
**功能**: 创建/编辑票务的对话框
**Props**:
```typescript
interface TicketDialogProps {
  open: boolean;
  ticket?: Ticket; // undefined 表示创建，有值表示编辑
  onClose: () => void;
  onSave: (data: TicketFormData) => Promise<void>;
}
```

#### 5.3.5 TagBadge 组件
**功能**: 标签徽章显示
**Props**:
```typescript
interface TagBadgeProps {
  tag: Tag;
  removable?: boolean;
  onRemove?: (tagId: number) => void;
}
```

**样式**: 使用标签的 color 属性作为背景色

#### 5.3.6 SearchBar 组件
**功能**: 搜索输入框
**Props**:
```typescript
interface SearchBarProps {
  placeholder: string;
  value: string;
  onChange: (value: string) => void;
  debounceMs?: number; // 默认 500ms
}
```

### 5.4 交互流程

#### 5.4.1 创建票务流程
1. 用户点击"新建票务"按钮
2. 打开对话框，显示表单（标题、描述、标签选择器）
3. 标签选择器支持：
   - 从现有标签列表选择（多选）
   - 创建新标签（输入名称，选择颜色）
4. 用户填写信息后点击"创建"
5. 发送 POST 请求到后端
6. 成功后关闭对话框，刷新票务列表，显示成功提示

#### 5.4.2 编辑票务流程
1. 用户点击票务卡片的编辑图标
2. 打开对话框，预填充当前票务信息
3. 用户修改信息
4. 点击"保存"发送 PUT 请求
5. 成功后关闭对话框，更新列表，显示成功提示

#### 5.4.3 删除票务流程
1. 用户点击票务卡片的删除图标
2. 显示确认对话框："确定要删除这个票务吗？此操作不可撤销。"
3. 用户确认后发送 DELETE 请求
4. 成功后从列表中移除该票务，显示成功提示

#### 5.4.4 切换完成状态流程
1. 用户点击票务卡片的复选框
2. 发送 PATCH 请求切换状态
3. 立即更新UI显示（乐观更新）
4. 如果失败则回滚UI状态

#### 5.4.5 标签筛选流程
1. 用户在侧边栏选择一个或多个标签
2. 更新URL查询参数（如果使用路由）
3. 发送 GET 请求获取过滤后的票务列表
4. 更新主内容区显示

#### 5.4.6 搜索流程
1. 用户在搜索框输入关键词
2. 500ms 延迟后触发搜索
3. 发送 GET 请求（包含 search 参数）
4. 更新票务列表显示
5. 显示搜索结果数量："找到 5 个结果"

### 5.5 响应式设计

#### 移动端适配（< 768px）
- 侧边栏折叠为底部抽屉或顶部下拉菜单
- 票务卡片全宽显示
- 操作按钮调整为图标按钮
- 搜索框可折叠

#### 平板端（768px - 1024px）
- 侧边栏宽度缩小
- 票务列表双列布局

#### 桌面端（> 1024px）
- 标准三栏布局
- 票务列表可选网格或列表视图

### 5.6 UI/UX 增强

#### 5.6.1 加载状态
- 骨架屏（Skeleton）显示加载中的票务列表
- 按钮加载状态（加载动画 + 禁用）
- 页面级加载指示器

#### 5.6.2 空状态
- 无票务时显示："暂无票务，点击上方按钮创建第一个票务"
- 搜索无结果："未找到匹配的票务，试试其他关键词"
- 标签筛选无结果："该标签下暂无票务"

#### 5.6.3 错误处理
- Toast 消息显示错误信息
- 网络错误时显示重试按钮
- 表单验证错误即时显示

#### 5.6.4 成功反馈
- 操作成功后显示 Toast 消息
- 绿色复选标记动画
- 列表项淡入淡出动画

#### 5.6.5 辅助功能
- 键盘导航支持
- ARIA 标签
- 高对比度模式支持
- 焦点管理

---

## 6. 后端架构设计

### 6.1 项目结构

```
backend/
├── app/
│   ├── main.py              # FastAPI 应用入口
│   ├── config.py            # 配置管理
│   ├── database.py          # 数据库连接
│   ├── models/              # SQLAlchemy 模型
│   │   ├── __init__.py
│   │   ├── ticket.py
│   │   ├── tag.py
│   │   └── ticket_tag.py
│   ├── schemas/             # Pydantic 模型（请求/响应）
│   │   ├── __init__.py
│   │   ├── ticket.py
│   │   └── tag.py
│   ├── api/                 # API 路由
│   │   ├── __init__.py
│   │   ├── tickets.py
│   │   ├── tags.py
│   │   └── deps.py          # 依赖注入
│   ├── services/            # 业务逻辑层
│   │   ├── __init__.py
│   │   ├── ticket_service.py
│   │   └── tag_service.py
│   └── utils/               # 工具函数
│       └── __init__.py
├── alembic/                 # 数据库迁移
│   ├── versions/
│   └── env.py
├── tests/                   # 测试
│   ├── test_tickets.py
│   └── test_tags.py
├── requirements.txt         # Python 依赖
├── .env.example             # 环境变量示例
└── README.md
```

### 6.2 核心依赖

```txt
fastapi>=0.109.0
uvicorn[standard]>=0.27.0
sqlalchemy>=2.0.25
psycopg2-binary>=2.9.9
alembic>=1.13.1
pydantic>=2.5.0
pydantic-settings>=2.1.0
python-dotenv>=1.0.0
```

### 6.3 SQLAlchemy 模型定义

#### 6.3.1 Ticket 模型
```python
from sqlalchemy import Column, Integer, String, Text, Enum, DateTime
from sqlalchemy.orm import relationship
from datetime import datetime
import enum

class TicketStatus(str, enum.Enum):
    PENDING = "pending"
    COMPLETED = "completed"

class Ticket(Base):
    __tablename__ = "tickets"
    
    id = Column(Integer, primary_key=True, index=True)
    title = Column(String(200), nullable=False, index=True)
    description = Column(Text, nullable=True)
    status = Column(Enum(TicketStatus), default=TicketStatus.PENDING, nullable=False)
    created_at = Column(DateTime(timezone=True), default=datetime.utcnow, nullable=False)
    updated_at = Column(DateTime(timezone=True), default=datetime.utcnow, onupdate=datetime.utcnow, nullable=False)
    
    # 关系
    tags = relationship("Tag", secondary="ticket_tags", back_populates="tickets")
```

#### 6.3.2 Tag 模型
```python
from sqlalchemy import Column, Integer, String, DateTime
from sqlalchemy.orm import relationship
from datetime import datetime

class Tag(Base):
    __tablename__ = "tags"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(50), unique=True, nullable=False, index=True)
    color = Column(String(7), default="#3B82F6", nullable=False)
    created_at = Column(DateTime(timezone=True), default=datetime.utcnow, nullable=False)
    
    # 关系
    tickets = relationship("Ticket", secondary="ticket_tags", back_populates="tags")
```

#### 6.3.3 TicketTag 关联表
```python
from sqlalchemy import Column, Integer, ForeignKey, DateTime, Table
from datetime import datetime

ticket_tags = Table(
    'ticket_tags',
    Base.metadata,
    Column('ticket_id', Integer, ForeignKey('tickets.id', ondelete='CASCADE'), primary_key=True),
    Column('tag_id', Integer, ForeignKey('tags.id', ondelete='CASCADE'), primary_key=True),
    Column('created_at', DateTime(timezone=True), default=datetime.utcnow, nullable=False)
)
```

### 6.4 Pydantic Schema 定义

#### 6.4.1 Ticket Schemas
```python
from pydantic import BaseModel, Field
from datetime import datetime
from typing import List, Optional

class TagBase(BaseModel):
    name: str
    color: str

class TagResponse(TagBase):
    id: int
    created_at: datetime
    
    class Config:
        from_attributes = True

class TicketBase(BaseModel):
    title: str = Field(..., max_length=200)
    description: Optional[str] = None

class TicketCreate(TicketBase):
    tag_ids: Optional[List[int]] = []

class TicketUpdate(BaseModel):
    title: Optional[str] = Field(None, max_length=200)
    description: Optional[str] = None

class TicketResponse(TicketBase):
    id: int
    status: str
    tags: List[TagResponse]
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class TicketListResponse(BaseModel):
    data: List[TicketResponse]
    total: int
    page: int
    page_size: int
    total_pages: int
```

### 6.5 Service 层设计

#### 6.5.1 TicketService
```python
from sqlalchemy.orm import Session
from typing import List, Optional

class TicketService:
    @staticmethod
    def get_tickets(
        db: Session,
        status: Optional[str] = None,
        tag_ids: Optional[List[int]] = None,
        search: Optional[str] = None,
        skip: int = 0,
        limit: int = 50
    ) -> List[Ticket]:
        # 实现筛选逻辑
        pass
    
    @staticmethod
    def get_ticket(db: Session, ticket_id: int) -> Optional[Ticket]:
        pass
    
    @staticmethod
    def create_ticket(db: Session, ticket_data: TicketCreate) -> Ticket:
        pass
    
    @staticmethod
    def update_ticket(db: Session, ticket_id: int, ticket_data: TicketUpdate) -> Ticket:
        pass
    
    @staticmethod
    def delete_ticket(db: Session, ticket_id: int) -> bool:
        pass
    
    @staticmethod
    def toggle_status(db: Session, ticket_id: int) -> Ticket:
        pass
    
    @staticmethod
    def add_tags(db: Session, ticket_id: int, tag_ids: List[int]) -> Ticket:
        pass
    
    @staticmethod
    def remove_tag(db: Session, ticket_id: int, tag_id: int) -> bool:
        pass
```

### 6.6 中间件与配置

#### 6.6.1 CORS 配置
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],  # Vite 默认端口
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

#### 6.6.2 环境变量配置
```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    DATABASE_URL: str = "postgresql://user:password@localhost:5432/project_alpha"
    DEBUG: bool = False
    
    class Config:
        env_file = ".env"
```

---

## 7. 开发与部署

### 7.1 开发环境设置

#### 7.1.1 后端设置
```bash
# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 配置环境变量
cp .env.example .env
# 编辑 .env 文件配置数据库连接

# 运行数据库迁移
alembic upgrade head

# 启动开发服务器
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

#### 7.1.2 前端设置
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 7.2 数据库设置

#### 7.2.1 PostgreSQL 安装

直接使用本地已运行的postgres容器，数据库名称为project_alpha，用户名为alpha_user，密码为alpha_pass

#### 7.2.2 初始数据迁移
```bash
# 创建迁移脚本
alembic revision --autogenerate -m "Initial migration"

# 执行迁移
alembic upgrade head
```

### 7.3 测试策略

#### 7.3.1 后端测试
- 单元测试：测试 Service 层业务逻辑
- 集成测试：测试 API 端点
- 测试工具：pytest, pytest-asyncio

#### 7.3.2 前端测试
- 组件测试：使用 Vitest + Testing Library
- E2E 测试：使用 Playwright（可选）

### 7.4 部署方案

直接使用本地已运行的postgres容器，数据库名称为project_alpha，用户名为alpha_user，密码为alpha_pass

---

## 8. 非功能性需求

### 8.1 性能要求
- API 响应时间：< 200ms (P95)
- 页面首次加载时间：< 2s
- 支持至少 1000 个票务的流畅浏览

### 8.2 安全性
- 虽然无需用户认证，但需要：
  - SQL 注入防护（使用 ORM 参数化查询）
  - XSS 防护（前端输出转义）
  - CSRF 防护（如果后续添加状态管理）
- 输入验证和清理

### 8.3 可维护性
- 代码注释和文档
- 统一的代码风格（ESLint, Prettier, Black, flake8）
- Git 版本控制
- 清晰的提交信息

### 8.4 可扩展性
- 模块化设计便于后续添加功能
- 预留用户认证系统接口
- 支持多语言国际化（i18n）准备

### 8.5 浏览器兼容性
- Chrome/Edge (最新版本)
- Firefox (最新版本)
- Safari (最新版本)
- 移动浏览器（iOS Safari, Chrome Mobile）

---

## 9. 项目里程碑

### Phase 1: 基础架构搭建（Week 1）
- [ ] 项目初始化（前后端脚手架）
- [ ] 数据库设计与迁移
- [ ] 基础 API 框架搭建
- [ ] 前端基础组件库集成

### Phase 2: 核心功能开发（Week 2-3）
- [ ] 票务 CRUD API 实现
- [ ] 标签 CRUD API 实现
- [ ] 票务-标签关联 API 实现
- [ ] 前端票务列表页面
- [ ] 前端票务创建/编辑功能

### Phase 3: 高级功能（Week 4）
- [ ] 标签筛选功能
- [ ] 搜索功能
- [ ] 状态切换功能
- [ ] 前端交互优化

### Phase 4: 测试与优化（Week 5）
- [ ] 单元测试编写
- [ ] 集成测试
- [ ] 性能优化
- [ ] UI/UX 优化

### Phase 5: 部署与文档（Week 6）
- [ ] Docker 容器化
- [ ] 部署到生产环境
- [ ] 用户文档编写
- [ ] API 文档生成

---

## 10. 附录

### 10.1 预设标签颜色方案
```javascript
const PRESET_COLORS = [
  { name: 'Red', value: '#EF4444' },
  { name: 'Orange', value: '#F97316' },
  { name: 'Amber', value: '#F59E0B' },
  { name: 'Yellow', value: '#EAB308' },
  { name: 'Lime', value: '#84CC16' },
  { name: 'Green', value: '#10B981' },
  { name: 'Emerald', value: '#059669' },
  { name: 'Teal', value: '#14B8A6' },
  { name: 'Cyan', value: '#06B6D4' },
  { name: 'Sky', value: '#0EA5E9' },
  { name: 'Blue', value: '#3B82F6' },
  { name: 'Indigo', value: '#6366F1' },
  { name: 'Violet', value: '#8B5CF6' },
  { name: 'Purple', value: '#A855F7' },
  { name: 'Fuchsia', value: '#D946EF' },
  { name: 'Pink', value: '#EC4899' },
  { name: 'Rose', value: '#F43F5E' }
];
```

### 10.2 TypeScript 类型定义示例
```typescript
// types/ticket.ts
export enum TicketStatus {
  PENDING = 'pending',
  COMPLETED = 'completed'
}

export interface Tag {
  id: number;
  name: string;
  color: string;
  created_at: string;
}

export interface Ticket {
  id: number;
  title: string;
  description?: string;
  status: TicketStatus;
  tags: Tag[];
  created_at: string;
  updated_at: string;
}

export interface TicketFilters {
  status?: TicketStatus | 'all';
  tag_ids?: number[];
  search?: string;
}

export interface PaginatedResponse<T> {
  data: T[];
  total: number;
  page: number;
  page_size: number;
  total_pages: number;
}
```

### 10.3 API 客户端封装示例
```typescript
// api/tickets.ts
import axios from 'axios';

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000/api/v1';

export const ticketsApi = {
  getTickets: (params: TicketFilters & { page?: number; page_size?: number }) =>
    axios.get<PaginatedResponse<Ticket>>(`${API_BASE_URL}/tickets`, { params }),
  
  getTicket: (id: number) =>
    axios.get<Ticket>(`${API_BASE_URL}/tickets/${id}`),
  
  createTicket: (data: TicketCreate) =>
    axios.post<Ticket>(`${API_BASE_URL}/tickets`, data),
  
  updateTicket: (id: number, data: TicketUpdate) =>
    axios.put<Ticket>(`${API_BASE_URL}/tickets/${id}`, data),
  
  deleteTicket: (id: number) =>
    axios.delete(`${API_BASE_URL}/tickets/${id}`),
  
  toggleStatus: (id: number) =>
    axios.patch<{ id: number; status: string; updated_at: string }>(`${API_BASE_URL}/tickets/${id}/toggle-status`),
  
  addTags: (id: number, tag_ids: number[]) =>
    axios.post<Ticket>(`${API_BASE_URL}/tickets/${id}/tags`, { tag_ids }),
  
  removeTag: (ticketId: number, tagId: number) =>
    axios.delete(`${API_BASE_URL}/tickets/${ticketId}/tags/${tagId}`)
};
```

### 10.4 示例数据
```json
// 示例票务数据
[
  {
    "id": 1,
    "title": "修复登录页面按钮样式",
    "description": "移动端显示不正常，需要调整响应式布局",
    "status": "pending",
    "tags": [
      { "id": 1, "name": "bug", "color": "#EF4444" },
      { "id": 2, "name": "frontend", "color": "#3B82F6" }
    ]
  },
  {
    "id": 2,
    "title": "实现数据导出功能",
    "description": "支持 CSV 和 Excel 格式",
    "status": "completed",
    "tags": [
      { "id": 3, "name": "feature", "color": "#10B981" },
      { "id": 4, "name": "backend", "color": "#8B5CF6" }
    ]
  }
]
```

---

## 文档变更记录

| 版本 | 日期 | 变更说明 | 作者 |
|------|------|----------|------|
| v1.0 | 2025-12-11 | 初始版本创建 | - |

---

**文档结束**

